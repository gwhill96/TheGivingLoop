<%# This is the home page %>
<%# List of donation choices & checkout basket %>
<%# http://localhost:3000/charity_profiles/1/donation_types %>

<h1>Home Page/Index Page for Donations</h1>

<div class="card_container">
<div class="card">
<% @donationtypes.each do |donationtype| %>
<li><%= donationtype.name %> - Â£ <%= donationtype.price %></li>
<%#if @user.charity? && donationtype.charity_profile.user_id == @user.id %>
<%# <%= link_to "View this card", :action => "charity_profiles", :id => @charity_profile.id, :controller => "donation_types", :id2 => donationtype.id %>
<%= link_to "Edit this card", edit_charity_profile_donation_type_path(@charity_profile.id, donationtype.id) if @user.charity? && donationtype.charity_profile.user_id == @user.id %>
<%# end %>
<%= simple_form_for [ @basket, @basket_item ] do |f| %>
  <%= f.hidden_field :donation_type_id, value: donationtype.id %>
  <%= f.submit "Add To Basket" %>
  <% end %>
<% end %>
</div>



<%#
  <%= form_with url:  basket_basket_items_path[@basket] do %>
    <%# <%= hidden_field_tag 'donation_type_id', donationtype.id %>
    <%# <%= hidden_field_tag 'basket_id', @basket.id %>
    <%# <%= submit_tag 'Add To Basket', class: 'btn btn-primary' %>
    <%# <%= raise %>
  <%# <% end %>
<%# photo for card %>


<br>

<div class="card"
  data-controller="basket-subscription"
  data-basket-subscription-basket-id-value="<%= @basket.id %>">
  <% if current_user.nil? %>
    <h3>My Basket</h3>
     <% if @basket.basket_items.empty? %>
     <p>empty basket</p>
     <% else %>
      <div class="basket-items" data-basket-subscription-target="basket-items">
        <div>
          <%= @basket.basket_items.count %>
          <%= link_to "View Final Basket", basket_path(@basket) %>
          <% sum = 0 %>
          <% @basket.basket_items.each do |item| %>
            <% sum += item.donation_type.price %>
          <% end %>
          <%= sum %>
        </div>
      <% end %>
    <%# <%= link_to "Check Out As Guest",  This form code below is for a different page %>
  <% elsif !current_user.charity %>
    <h3>My Basket</h3>
        <% if @basket.basket_items.empty? %>
          <p>empty basket</p>
        <% else %>
          <div>
            <%= @basket.basket_items.count %>
            <%= link_to "View Final Basket", basket_path(@basket) %>
            <% sum = 0 %>
            <% @basket.basket_items.each do |item| %>
              <% sum += item.donation_type.price %>
            <% end %>
            <%= sum %>
          </div>
        <% end %>
  <% elsif current_user.charity %>
    <h1>Welcome to the charity page</h1>
  <% end %>
  </div>

  <%# <% @donationtypes.each do |donationtype| %>
  <%# <%= donationtype.name %>
  <%# <%= donationtype.price %>
<%# photo for card %>
  <%# <% end %>


<%# <% if false %>
<%# Commenting out below makes home page work %>
<%# <%= form_with url: basket_items_path do %>
  <%# <%= hidden_field_tag 'donation_type_id', @donation_type.id %>
  <%# <%= submit_tag 'Add To Basket', class: 'btn btn-primary' %>
<%# <% end %>

<%# <div>
<% if current_user.charity %>
  <%# <%= link_to "Edit this card", edit_charity_profile_donation_type_path(@donationtype) %>
<%# <% end %>
<%# </div> %>
